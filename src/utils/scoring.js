import questions from '../data/questions.json';
import types from '../data/types.json';

// 性格分析軸（内部用）
const PRIMARY_AXES = ['E_I', 'S_N', 'T_F', 'J_P'];
// 裏キャラ軸
const SPICE_AXES = ['Approval', 'Obsession', 'Emotion', 'Fickle'];
// 全軸
const ALL_AXES = [...PRIMARY_AXES, ...SPICE_AXES];

// タイプキー一覧（URL用ID変換）
const TYPE_KEYS_LIST = [
  'INTJ', 'INFJ', 'INTP', 'ISTP', 'ENTJ', 'ESTJ', 'ENTP', 'ENFP',
  'ISTJ', 'ISFJ', 'ISFP', 'INFP', 'ESTP', 'ESFP', 'ENFJ', 'ESFJ',
];

// Spice軸ごとの高スコア修飾語（maxScore >= 3）
const SPICE_MODIFIERS = {
  Approval: '加工上手の',
  Obsession: '鍵アカストーカーの',
  Emotion: '即泣き地雷原な',
  Fickle: 'べらべら',
};

// 中間スコア修飾語（maxScore 0〜2）
const NEUTRAL_MODIFIERS = ['平凡な', '量産型の'];

// 全軸マイナス修飾語（maxScore < 0）
const CALM_MODIFIERS = ['悟りを開いた', '無害な'];

// 修飾語ごとの解説テキスト（結果に自然に組み込む）
export const MODIFIER_DETAILS = {
  '加工上手の': '🎭 自分の見せ方を熟知している策士タイプやねん。SNSでは完璧な自分を演出し、リアルでも「いい感じの自分」を無意識にプロデュース。加工と現実の境目がもはや本人にもわからんくなっとる。本音と建前の使い分けが異常にうまく、「あれ、この人いつも完璧やな」と思ったら、裏で相当な努力をしてるか、相当な嘘ついてるかのどっちかやで。知らんけど。\n\n📸 たとえばな、カフェ行っても飲む前にまず15分撮影会やねん。「自然光が〜」とか言うて席3回変えるし、ラテアートが崩れたら新しいの頼むし、もう何しに来たんかわからへん。プリクラの盛りは序の口、今や動画も画像も「ちょい調整」いう名の大工事や。友達との写真で自分だけ加工して「なんか私だけ顔ちっさない？」とか言い出すのもこのタイプ。本人のインスタと免許証見比べたら「誰？」ってなるやつやねん。\n\n📱 【SNS行動パターン】インスタのストーリーは1日平均8個。投稿は最低30枚から厳選して、FacetimeとかLightroomとか加工アプリ5個経由が基本動線。フォロワーの増減を毎日チェックして、いいねの数で一喜一憂してるけど表には出さへん。TikTokでは「すっぴん風メイク」の動画上げるけど、そのすっぴん風が一番手間かかっとるというね。他人の投稿には秒速でいいねするけど、それも「いいね返し」を計算した戦略的いいねやから恐ろしいわ。\n\n💕 【恋愛パターン】マッチングアプリの写真は別人レベルの奇跡の一枚を使用。初デートで相手が「あれ…？」って顔するのがお約束やねん。でもな、トークスキルでカバーするのがこのタイプのすごいところ。恋人ができたらSNSに匂わせ投稿が始まるけど、絶対に直接は言わへん。「今日は特別な人とディナー🍷」とか、もうバレバレやのに本人は「え、何のこと？」ってシラ切るねん。別れた後は関連投稿を光速でアーカイブ。存在ごと消去する手際の良さはプロ級やで。\n\n🔑 【この人への対処法】加工の裏にある「認められたい」って気持ちを理解したるのが大事やねん。「すごいね」「センスいいね」って褒めたら素直に喜ぶし、信頼したら意外と素の顔も見せてくれるで。ただし「加工しすぎやろ」とか直球で言うたら二度と心開かへんから注意な。否定じゃなくて「ナチュラルな方も好きやで」って伝えるのがコツ。知らんけど。',

  '鍵アカストーカーの': '🔍 気になる人のSNSは鍵アカまで徹底チェックする執念のタイプやねん。相手の行動パターンを無意識に把握しとって、「偶然だね！」っていう出会いは全部計算済みや。執着心が強くて、一度ロックオンしたら絶対離さへん。本人は「ちょっと気になっただけ」って言い張るけど、相手の3年前の投稿まで遡っとるからな。情報収集能力だけはCIA級やで。\n\n🕵️ あのな、このタイプの恐ろしさ舐めたらあかんで。好きな人ができたらまずフルネーム検索、次にインスタ・X・Facebook・TikTok全部特定。鍵アカは共通の友達経由で突破するし、相手のフォロー・フォロワーリストまで完全に把握しとんねん。「この子誰？最近いいね多いな」とか、もう探偵事務所開けるレベルや。相手が行ったレストランの場所を投稿の背景から特定して、翌週さりげなく「ここ気になってたんよね〜」って行くのも朝飯前。相手の元カレ・元カノの現在の交際状況まで調べ上げとるけど、本人は「なんとなく知ってた」で通すねん。知らんけど。\n\n📱 【SNS行動パターン】自分の投稿は控えめやのに、閲覧時間はエグい。ストーリーは絶対足跡つけへんように別アカから見る用意周到さ。スクショフォルダに気になる人の投稿が時系列で保存されとる。相手がフォローした新しいアカウントは24時間以内にチェック済み。「あの人最近○○にハマってるみたい」って情報を、本人より先に知っとるのがこのタイプや。いいねは押さへんけど全投稿見てるから、実質ストーリーの視聴率100%やねん。Xのリスト機能も当然フル活用で、非公開リストに気になる人全員ぶち込んどる。\n\n💕 【恋愛パターン】好きな人ができたら、まず2週間の情報収集期間に入るねん。相手の好きな食べ物、音楽、休日の過ごし方を全部SNSから割り出して、「え、私もそれ好き！運命やん！」って共通点を演出するのがお得意パターン。マッチングアプリでは相手のプロフィールを暗記してから「いいね」するし、初デートの会話で「え、それ知ってる！」って言うけど全部事前調査済みやからな。付き合ったら付き合ったで、相手のスマホの通知チラ見が日課になる。「誰からLINE来たん？」って聞かへんけど、目はしっかり見てるで。別れた後も元カレ・元カノのSNSを3年は監視し続ける粘着力。\n\n🔑 【この人への対処法】「そんなに気にかけてくれてるんやな」って肯定的に受け止めたるのが第一歩やねん。ただし境界線はしっかり引かなあかんで。「LINEの返信は1日以内にするから安心して」みたいに、安心材料を先に渡したるのがコツ。不安にさせたら調査活動が加速するだけやから、適度に情報開示してあげるのが吉。「隠し事ないで」って態度見せたら、意外と執着が和らぐタイプやねん。知らんけど。',

  '即泣き地雷原な': '💣 感情の起伏が激しくて、些細なことで涙腺崩壊するタイプやねん。「え、そこで泣く？」っていう場面で泣いて、周囲を困惑させまくる。感情に正直すぎて自分でもコントロールできてへんくて、怒りも悲しみも嬉しさも全部120%で出力されんねん。一緒におると感情の渦に巻き込まれるけど、その分リアクションは最高にわかりやすいで。\n\n😭 具体的に言うたらな、LINEの返信が「。」で終わっただけで「怒ってる…？」って泣くし、レストランで注文間違えられても泣くし、犬の動画見ても泣くし、もうほんまに涙腺どうなっとんねん。飲み会では3杯目あたりから感情のダムが決壊して、「私のこと本当に友達と思ってる…？」って号泣タイム突入や。感動系のCM見ただけで鼻すすりだすし、卒業ソング聴いたら卒業関係なくても泣くし、天気予報の「明日は雨です」にすら「なんか切ない…」って目がウルウルするタイプやねん。周りは「またか…」って思いつつも、あの号泣を無視できへんから結局みんな振り回されとる。地雷の場所が毎日変わるから、もう歩くだけで爆発する感じやで。知らんけど。\n\n📱 【SNS行動パターン】深夜2時に病みポスト投下が十八番やねん。「もう無理かも」「誰かわかって」みたいなポエムをXに投稿して、30分後に消す。でもスクショ撮られてるのは計算外や。インスタのストーリーで意味深な歌詞を載せるのも鉄板で、「この歌詞、今の気持ちそのまま…」って、いやお前どの気持ちやねん。TikTokでは泣ける系の動画に共感コメント大量に残して、「わかる😭😭😭」って絵文字の数がいつも異常。気分がいい日は突然テンション爆上がりの投稿して、フォロワーに情緒不安定を心配される無限ループやねん。\n\n💕 【恋愛パターン】好きな人ができたらもう大変。相手の一挙一動に感情が乱高下するから、LINEの既読スルー1回で「嫌われた」って泣き、返信来たら「嬉しい！」って泣き、もう泣いてばっかりやねん。デート中に「今日楽しいね」って言われただけで感動の涙を流すし、相手は「え、なんかした？」って困惑する。喧嘩になったら泣いて話し合いが進まへんし、仲直りしても泣くし、記念日にも泣くし、もう相手のハンカチ常にびしょびしょ。マッチングアプリのプロフィールに「感受性豊かです」って書いてるけど、翻訳すると「地雷原です」やからな。別れ話なんかしたら、もう大洪水。近所迷惑レベルの号泣で、別れるのに3ヶ月かかるパターンやで。\n\n🔑 【この人への対処法】泣いてる時に「なんで泣いてんの？」は最悪の一手や。まず黙って隣におって、落ち着くまで待つのが正解やねん。「泣いてもいいよ」って言うたるだけでだいぶ救われるタイプや。ただし、毎回感情に付き合ってたらこっちが消耗するから、「今日はちょっとしんどいから明日話聞くわ」って自分の限界も伝えるのが大事。感情を否定せず、でも振り回されすぎず。このバランスが取れたら、めちゃくちゃ信頼してくれるで。知らんけど。',

  'べらべら': '🗣️ 秘密を守れない口の軽さが致命的なタイプやねん。「ここだけの話やけど」を最低3人に話す。悪気はまったくないんやけど、情報の拡散力は天才的や。沈黙が苦手で、場を埋めるために余計なことまで喋る。本人は「コミュ力が高い」って思ってるけど、周囲は「あいつには秘密話すな」で一致団結しとるねん。\n\n🎤 もうな、このタイプと秘密を共有した時点で「公開情報」になったと思った方がええで。「絶対言わんといてな」って前置きした話が、翌日にはグループLINEで「みんなもう知ってると思うけど〜」って展開されてるから恐ろしいわ。飲み会では独壇場で、他人の恋愛事情を実況中継みたいに喋り散らかす。「あ、これ言うたらあかんやつやった」って気づく頃には全部喋り終わっとるし、「ごめん！でも面白いからつい〜」で済ますメンタルの強さよ。会議中でも関係ない話を挟んでくるし、電車の中で電話する声もデカい。静かにしろって言うても5分が限界で、すぐ「そういえばさ〜」って始まるねん。知らんけど。\n\n📱 【SNS行動パターン】Xの投稿頻度が異常。1日30ツイートは余裕で、朝の「おはよ」から夜の「寝れない」まで脳内垂れ流し状態やねん。リプライ欄では知らん人とも即友達みたいに絡むし、フォロワーの人間関係図を勝手に実況する。インスタのストーリーは24時間途切れへんし、ライブ配信は「今から配信するわ」って告知なしにゲリラ開催。TikTokのコメント欄では長文感想を書いて、投稿者本人より目立っとる。グループLINEでは既読つく前にもう5通送っとるし、「長いわ」って言われても「あ、もう一個あった」って追撃する。情報のアウトプット量だけは大企業の広報部レベルやで。\n\n💕 【恋愛パターン】好きな人ができたら0.3秒で周囲に言いふらすから、本人に告白する前に相手の耳に届いてるパターンが鉄板やねん。デートの内容はリアルタイムで友達にLINE報告するし、「今キスした！」とか実況するからほんまプライバシーって概念がないねん。恋人との喧嘩も全部友達に筒抜けで、「あいつがさ〜」って愚痴を5人に話すから、恋人は知らん間に周囲から白い目で見られとる。マッチングアプリでは「話し上手です」ってアピールするけど、正確には「話し過ぎです」やねん。別れた後は「実は別れてん…」って言うまでもなく、もうみんな知っとるわ。\n\n🔑 【この人への対処法】大前提として「この人に話した情報は公開される」と覚悟を決めることやねん。本当に秘密にしたいことは絶対に話さへんこと。でもな、逆に考えたら情報拡散してほしい時には最高の味方やで。「これみんなに広めてほしいんやけど」って頼んだら、SNSの広告より早く拡散してくれる。黙らせようとするんじゃなくて、「話してOKなこと」と「話したらアウトなこと」を明確に伝えるのがコツ。あと、この人の話の中で本当に重要なんは3割くらいやから、残り7割は聞き流す技術を磨くのが共存の秘訣やで。知らんけど。',

  '平凡な': '🌿 裏表が少なくて、見たままの人間やねん。特に隠された闇はないんやけど、逆に言えば「つかみどころがない」って思われがちやな。平和主義で波風立てへんし、どんなグループでもそこそこうまくやれる器用さがある。\n\n🏠 ぶっちゃけな、このタイプが一番レアかもしれへんで。だってSNS全盛期のこの時代に「普通でおれる」って実は相当すごいことやねん。周りがキラキラ投稿したり病みツイートしたりしてる中で、揺るがへんこの安定感。休日は家でNetflix観て、たまに友達とご飯行って、特に事件も起きず平和に過ごすタイプ。「最近なんかあった？」って聞いても「特にないなあ」で終わるから、ドラマチック好きの人からしたら物足りへんかもしれん。でもな、こういう人が一人おるだけでグループの空気がめちゃくちゃ安定するねん。嵐の中の灯台みたいなもんや。知らんけど。\n\n📱 【SNS行動パターン】インスタの投稿は月1あるかないかで、内容は飯の写真か旅行の風景。ストーリーは他人のを見る専門で、自分からはほぼ上げへん。Xはアカウント持ってるけど鍵アカでフォロワー30人、たまに「眠い」とか「腹減った」とかつぶやくくらい。TikTokは見る専100%で、自分が映る動画なんて撮ったことない。LINEのアイコンは3年前の旅行写真のまま。プロフィールの一言は初期設定のまま。SNSに人生かけてるタイプからしたら「この人生きてる…？」って心配されるレベルの静けさやねん。\n\n💕 【恋愛パターン】恋愛もまあ穏やかやねん。好きな人ができても自分からガツガツ行かへんし、告白も「タイミングが来たら」って待つタイプ。付き合ったらデートは定番コースで、記念日は覚えてるけどサプライズとかはせえへん。でもな、この安定感が逆にめちゃくちゃ安心するっていう人も多いねん。ドラマチックな恋愛に疲れた人がたどり着く「最終駅」がこのタイプや。マッチングアプリのプロフィールは地味すぎて埋もれるけど、実際会ったら「普通にいい人やん」ってなるパターン。浮気とかする発想もエネルギーもないから、信頼度は抜群やで。\n\n🔑 【この人への対処法】「普通であること」を否定せんといてあげることが大事やねん。「もっと個性出したら？」とか「なんか趣味ないの？」とか言うのは禁句。この人はこの人のペースで十分幸せにやっとるから、そこに余計なお世話は要らんねん。一緒にいる時は気負わず自然体で過ごすのが一番。逆にこっちがテンション高すぎると引かれるから注意。ゆっくりお茶でも飲みながらだらだら喋る、そういう時間を大事にできる人がこのタイプとは相性ええで。知らんけど。',

  '量産型の': '🏭 流行に乗りやすくて、周りに合わせるのが得意なタイプやねん。突出した個性は控えめやけど、どんな場にも馴染める適応力がある。良くも悪くも「普通」が最大の武器で、敵を作らへん処世術を無意識にマスターしとる。\n\n👯 このタイプの特徴はな、トレンドを追いかけるスピードが異常やねん。流行りのカフェは初週で行くし、バズったコスメは即購入、TikTokで話題のダンスも3日で習得する。友達グループ内では「あ、それ私も気になってた！」が口癖で、基本的に周りの好きなものに合わせていくスタイル。服のセンスもみんなと似てるから、集合写真撮ったら同じブランドのバッグが3つ並ぶとか日常茶飯事や。本人は「自分の好みで選んでる」って主張するけど、その「好み」がインフルエンサーの推し商品そのまんまやからバレバレやねん。でもな、この「空気を読んで合わせる能力」は社会生活においては最強のスキルやで。知らんけど。\n\n📱 【SNS行動パターン】インスタの投稿はまるで教科書みたいに王道やねん。おしゃれカフェ、季節のイベント、友達との集合写真。ハッシュタグは流行りのやつを10個以上つけて、フィルターはその時期に一番バズってるやつを使う。ストーリーは「〇〇なう」系が多くて、みんなが行ってるスポットには必ず行く。TikTokではバズり動画の二番煎じを量産して、いいねが100超えたら大喜び。Xではトレンドワードに便乗したツイートを定期的に投下。要するにSNS界の「優等生」やねん。炎上もしーひんし、バズりもしーひん、安全運転のSNSライフやで。\n\n💕 【恋愛パターン】好きになるタイプも「みんなが好きそうな人」やから、人気者を好きになりがち。恋愛ドラマや恋愛リアリティ番組を参考にデートプランを考えるから、「あ、これどっかで見たことあるな」ってデートになる。マッチングアプリのプロフィールは教科書通りで、趣味は「カフェ巡り・旅行・映画鑑賞」の三種の神器。メッセージのやり取りも「わかるー！」「それめっちゃいいね！」って同意から入るスタイル。付き合ったら記念日はしっかり祝うし、イベントも全部こなすけど、全部がテンプレ感あるのがちょっと切ない。でもな、安定してるし、大外れがないのはこのタイプの強みやで。\n\n🔑 【この人への対処法】この人の「量産型」を馬鹿にしたらあかんで。本人は流行を追いかけてるんじゃなくて「いいものを選んでる」って思ってるから、「それみんな持ってるやん」は地雷やねん。「センスいいね」「それどこの？」って褒めたるのが正解。あと、たまにこの人だけの独自の好みを見つけたら大事にしたってな。「これ、あなたらしいね」って言われたらめちゃくちゃ嬉しいタイプやから。一緒に流行りを楽しめる人が相性ええし、「俺は流行とか興味ないから」みたいなスタンスの人とは水と油やで。知らんけど。',

  '悟りを開いた': '🧘 人間関係のドロドロから一歩引いた超越者タイプやねん。執着が少なくて、達観しとる。周囲からは「大人やね」って言われるけど、本人は単にめんどくさいだけっていう可能性も高いで。感情に振り回されへん安定感はあるけど、逆に「何考えてるかわからん」って距離置かれることもあるねん。\n\n🏔️ このタイプはな、飲み会で周りが恋愛トークで盛り上がってても「へえ〜」で終わらせるし、職場の人間関係のゴタゴタも「まあそのうち収まるやろ」って達観しとる。誕生日忘れられても怒らへんし、LINEグループの会話に3日くらい参加せんでも平気やねん。友達が「あの子ムカつく！」って愚痴ってきても「そっかあ」「まあ人それぞれやしなあ」って返すから、愚痴りたい側からしたら「もうちょっと共感してくれん！？」ってなる。でもな、この人が本気で怒った時はマジでヤバいで。年に1回あるかないかやけど、その時の迫力は凄まじい。普段穏やかな分、ギャップで周囲が凍りつくねん。知らんけど。\n\n📱 【SNS行動パターン】SNSのアカウントは一応持ってるけど、ほぼ幽霊アカウント。最後の投稿が「2年前」とかザラやねん。フォロー数よりフォロワー数の方が少ないっていう珍しい生態。たまにXを開いても「いいね」だけ押して閉じる。インスタのストーリーなんて見方すら怪しい。周りが「この前のストーリー見た？」って聞いても「ごめん、見てないわ」が定番。TikTokに至っては「あれ何？短い動画のやつ？」ってレベルの人もおる。デジタルデトックスを意識的にやってるわけちゃうねん、そもそも興味がないだけ。SNS疲れとは無縁の、ある意味最強のメンタルやで。\n\n💕 【恋愛パターン】恋愛においても執着が薄いから、「追いかけてこない人」として逆にモテるパターンがあるねん。好きな人ができても自分からグイグイ行かへんし、「ご縁があれば」ってスタンス。付き合っても束縛ゼロやから、自由を愛するタイプには最高の相手。でもな、記念日忘れるし、サプライズなんか一生しーひんし、「もうちょっと特別感出してよ！」って怒られるのがお約束やねん。マッチングアプリはそもそもやらへん、「出会いは自然がいい」って言うけど、自然な出会いを求める行動もしてへんから永遠に独身の可能性あるで。別れる時もあっさりしてて、「そっか、じゃあしょうがないな」で終わるから、相手からしたら「もっと引き止めてよ！」ってなるやつ。\n\n🔑 【この人への対処法】この人に感情的にぶつかっても暖簾に腕押しやから、冷静に論理的に話すのが一番やねん。「察してよ」は通じへんから、思ってることは言葉にして直接伝えること。あと、この人の「無関心」は「嫌い」とは違うから、反応が薄くても気にせんでええで。信頼関係ができたら、ぽつぽつと本音を話してくれるようになるから、焦らずゆっくり距離を詰めるのが吉。押しすぎると「めんどくさ」ってシャッター下ろされるから、適度な距離感を保つのがコツやで。知らんけど。',

  '無害な': '🐑 毒にも薬にもならへん究極の安全牌タイプやねん。誰とも争わず、誰も傷つけへん。ただし本音を隠してるだけの可能性もあって、本当の自分は誰も知らんねん。一見穏やかやけど、水面下で何考えてるかは永遠の謎やで。\n\n🎭 このタイプの恐ろしさはな、「無害」の仮面の下に何があるか誰にもわからへんところやねん。会議では全員の意見に「いいと思います」って頷くし、ランチの場所も「どこでもいいよ」やし、友達の相談には「大変やったね」って寄り添うけど、自分の意見は絶対言わへん。「怒ったことある？」って聞いたら「うーん、あんまりないかな」って答えるけど、本当に怒らへんのか、怒りを完璧に隠してるのか、誰にもわからん。20年来の親友ですら「あいつの本音聞いたことない」って言うレベルやで。ある日突然キレたら、溜め込んだ分えげつない爆発力になるから、実は一番怖いのこのタイプかもしれへん。知らんけど。\n\n📱 【SNS行動パターン】SNSでは完全なROM専（読む専門）やねん。アカウントはあるけど投稿ゼロ、プロフィール画像はデフォルトのまま。でもな、ちゃっかり全部見てるから情報量はエグいねん。「あのストーリー見た？」って振ったら「あ、うん、見たよ」って答えるから、存在感ないけど情報は持ってるタイプ。いいねすら押さへんから、フォロワーに「この人生存してるんかな」って思われとる。LINEも既読つけるのは早いけど、返信は最低限。グループLINEでは他の人が盛り上がってるのを静かに見守って、たまに「笑」って一言だけ入れる。その「笑」に何の感情が込められてるかは永久に解読不能やで。\n\n💕 【恋愛パターン】恋愛でも相手に合わせまくるから、「何がしたい？」「どこ行きたい？」って聞いても「なんでもいいよ」しか返ってこえへん。デートプランは全部相手任せで、食べたいものも「あなたが食べたいもので」って言う。一見優しいようやけど、相手からしたら「この人本当に楽しんでるんかな…」って不安になるパターンやねん。マッチングアプリでは「穏やかな人です」ってプロフィールで、実際穏やかなんやけど、穏やかすぎて何回デートしても距離が縮まらへん。付き合えたとしても「好き」って言葉をなかなか言わへんから、相手が不安になって「私のこと好きなん？」って聞くまでがワンセット。実は心の中ではめちゃくちゃ好きなんやけど、表現力が壊滅的やねん。\n\n🔑 【この人への対処法】「なんでもいいよ」を額面通り受け取ったらあかんで。本当は意見があるけど言えへんだけの可能性大やから、二択で聞くのがコツやねん。「カフェとラーメンどっちがいい？」みたいに選択肢を絞ったら、ぽろっと本音が出ることがあるで。あと、この人が珍しく自分の意見言った時は、絶対に否定したらあかん。「それいいやん！」って全力で肯定してあげること。そうすると少しずつ心を開いてくれるようになるねん。無理に本音を引き出そうとせず、「話したい時に話してくれたらええよ」ってスタンスが一番。安心できる環境を作ったるのが、この人の殻を破る唯一の方法やで。知らんけど。',
};

/**
 * ボタン値(1-5)を内部スコア(+2〜-2)に変換
 * 1=+2(せやねんせやねん), 2=+1, 3=0, 4=-1, 5=-2(全然ちゃうわ)
 */
function buttonToScore(buttonValue) {
  return 3 - buttonValue;
}

/**
 * Spiceスコアから修飾語（Modifier）を決定
 */
function determineModifier(spiceScores) {
  let maxAxis = SPICE_AXES[0];
  let maxScore = spiceScores[maxAxis];

  for (const axis of SPICE_AXES) {
    if (spiceScores[axis] > maxScore) {
      maxScore = spiceScores[axis];
      maxAxis = axis;
    }
  }

  if (maxScore >= 4) {
    return SPICE_MODIFIERS[maxAxis];
  }

  // 決定的に選択：全Spiceスコアの合計の絶対値を使う（同じ回答 → 同じ結果を保証）
  const totalSpice = Math.abs(SPICE_AXES.reduce((sum, axis) => sum + spiceScores[axis], 0));

  if (maxScore >= 0) {
    return NEUTRAL_MODIFIERS[totalSpice % NEUTRAL_MODIFIERS.length];
  }
  return CALM_MODIFIERS[totalSpice % CALM_MODIFIERS.length];
}

/**
 * 内部タイプキー → URL用数値ID
 */
export function typeKeyToId(key) {
  const idx = TYPE_KEYS_LIST.indexOf(key);
  return idx >= 0 ? idx : 0;
}

/**
 * URL用数値ID → 内部タイプキー
 */
export function idToTypeKey(id) {
  const n = parseInt(id, 10);
  return TYPE_KEYS_LIST[n] || TYPE_KEYS_LIST[0];
}

/**
 * 回答から全軸のスコアを計算し、タイプキーと修飾語を返す
 * @param {Object} answers - { questionId: buttonValue(1-5) }
 */
export function calculateResult(answers) {
  const scores = {};
  for (const axis of ALL_AXES) {
    scores[axis] = 0;
  }

  questions.forEach((q) => {
    const raw = answers[q.id];
    if (raw == null) return;

    const answerScore = buttonToScore(raw);

    for (const [axis, weight] of Object.entries(q.axes)) {
      if (scores[axis] !== undefined) {
        scores[axis] += answerScore * weight;
      }
    }
  });

  const ei = scores.E_I >= 0 ? 'E' : 'I';
  const sn = scores.S_N >= 0 ? 'S' : 'N';
  const tf = scores.T_F >= 0 ? 'T' : 'F';
  const jp = scores.J_P >= 0 ? 'J' : 'P';

  const typeKey = `${ei}${sn}${tf}${jp}`;
  const modifier = determineModifier({
    Approval: scores.Approval,
    Obsession: scores.Obsession,
    Emotion: scores.Emotion,
    Fickle: scores.Fickle,
  });

  const result = types[typeKey] || types['ESTJ'];

  return { typeKey, modifier, result };
}

/**
 * タイプキーからタイプ情報を取得（フォールバック付き）
 */
export function getTypeByKey(typeKey) {
  if (!typeKey) return { key: 'ESTJ', data: types['ESTJ'] };
  if (types[typeKey]) return { key: typeKey, data: types[typeKey] };
  return { key: 'ESTJ', data: types['ESTJ'] };
}

/**
 * 全問回答済みかチェック
 */
export function isAllAnswered(answers) {
  return questions.every((q) => answers[q.id] != null);
}
